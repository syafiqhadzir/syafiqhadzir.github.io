// ============================================================================
// CUSTOM UTILITY CLASSES
// Expert-Level Tailwind + Sass Utilities
// ---
// Strategy:
// 1. Remove duplicate utilities already provided by Tailwind
// 2. Keep only domain-specific utilities not in Tailwind
// 3. Use Sass for dynamic utility generation
// 4. Leverage @layer utilities for proper cascade
// ============================================================================

@use '../abstracts' as *;

// ============================================================================
// CUSTOM UTILITIES LAYER
// These complement Tailwind's built-in utilities
// ============================================================================

@layer utilities {
    // ========================================================================
    // ACCESSIBILITY UTILITIES (Enhanced beyond Tailwind)
    // ========================================================================

    // Visually hidden but accessible (Tailwind has sr-only, keeping for compatibility)
    .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        margin: -1px;
        padding: 0;
        overflow: hidden;
        white-space: nowrap;
        border: 0;
        clip-path: inset(50%);
    }

    // Make sr-only visible on focus
    .sr-only-focusable:focus {
        position: static;
        width: auto;
        height: auto;
        margin: 0;
        overflow: visible;
        white-space: normal;
        clip-path: none;
    }

    // Enhanced skip link with better positioning
    .skip-link {
        position: absolute;
        top: -100%;
        left: 50%;
        z-index: var(--z-tooltip);
        padding: var(--space-sm) var(--space-md) var(--space-sm) var(--space-md);
        color: var(--color-text-inverse);
        background-color: var(--color-accent);
        border-radius: var(--border-radius-md);
        transition: all var(--transition-fast);
        transform: translateX(-50%);

        &:focus {
            top: var(--space-sm);
        }
    }

    // ========================================================================
    // PRINT UTILITIES
    // ========================================================================

    .print-only {
        display: none;

        @media print {
            display: block;
        }
    }

    .no-print {
        @media print {
            display: none;
        }
    }

    // ========================================================================
    // TEXT UTILITIES (Domain-specific)
    // Using CSS custom properties for theme-aware colors
    // ========================================================================

    .text-heading {
        color: var(--color-text-heading);
    }

    .text-inverse {
        color: var(--color-text-inverse);
    }

    .bg-primary {
        background-color: var(--color-bg-primary);
    }

    .bg-secondary {
        background-color: var(--color-bg-secondary);
    }

    .bg-tertiary {
        background-color: var(--color-bg-tertiary);
    }

    // ========================================================================
    // LEGACY SUPPORT UTILITIES
    // Keeping for backwards compatibility - consider migrating to Tailwind
    // ========================================================================

    .alignable {
        display: inline-block;
    }

    .pull-right {
        float: right;
    }

    .pull-left {
        float: left;
    }

    // ========================================================================
    // ADVANCED INTERACTION UTILITIES
    // ========================================================================

    // Focus ring using design tokens
    .focus-ring {
        &:focus-visible {
            outline: var(--focus-ring-width) solid var(--focus-ring-color);
            outline-offset: var(--focus-ring-offset);
        }
    }

    // ========================================================================
    // DARK MODE UTILITIES (AMP-specific)
    // Using body class instead of Tailwind's dark: variant for AMP compatibility
    // ========================================================================

    body.dark {
        .dark\:bg-dark {
            background-color: var(--color-bg-dark, #1a1a2e);
        }

        .dark\:text-light {
            color: var(--color-text-light, #e8e8e8);
        }
    }

    // ========================================================================
    // SASS MIXIN-BASED UTILITIES
    // Complex utilities that leverage Sass mixins
    // ========================================================================

    // Text truncation variants
    .truncate-2 {
        @include truncate(2);
    }

    .truncate-3 {
        @include truncate(3);
    }

    .truncate-4 {
        @include truncate(4);
    }

    // ========================================================================
    // FLUID TYPOGRAPHY UTILITIES
    // Sass-powered responsive typography
    // ========================================================================

    .text-fluid-sm {
        font-size: clamp(0.875rem, 0.8rem + 0.5vw, 1rem);
    }

    .text-fluid-base {
        font-size: clamp(1rem, 0.95rem + 0.5vw, 1.125rem);
    }

    .text-fluid-lg {
        font-size: clamp(1.125rem, 1rem + 0.75vw, 1.5rem);
    }

    .text-fluid-xl {
        font-size: clamp(1.5rem, 1.3rem + 1vw, 2.25rem);
    }

    // ========================================================================
    // ASPECT RATIO UTILITIES (Supplement Tailwind)
    // ========================================================================

    .aspect-golden {
        aspect-ratio: 1.618 / 1;
    }

    .aspect-photo {
        aspect-ratio: 4 / 3;
    }

    // ========================================================================
    // TOUCH TARGET UTILITIES (Accessibility)
    // ========================================================================

    .touch-target {
        min-width: var(--touch-target-min);
        min-height: var(--touch-target-min);
    }

    // ========================================================================
    // FOCUS TRAP UTILITIES
    // For modal and dialog accessibility
    // ========================================================================

    .focus-trap {
        &:focus {
            outline: 2px solid var(--color-accent);
            outline-offset: 2px;
        }
    }

    // ========================================================================
    // SASS-GENERATED RESPONSIVE UTILITIES
    // Example: Generate gap utilities for all breakpoints
    // ========================================================================

    // Generate gap utilities using Sass loops
    @each $name, $value in (
        '2xs': var(--space-2xs),
        'xs': var(--space-xs),
        'sm': var(--space-sm),
        'md': var(--space-md),
        'lg': var(--space-lg),
        'xl': var(--space-xl),
        '2xl': var(--space-2xl),
        '3xl': var(--space-3xl)
    ) {
        // Responsive gap utilities using Sass mixins
        @include media-up('md') {
            .md\:gap-#{$name} {
                gap: $value;
            }
        }

        @include media-up('lg') {
            .lg\:gap-#{$name} {
                gap: $value;
            }
        }
    }

    // Reduced motion safe animations
    @media (prefers-reduced-motion: reduce) {
        .motion-safe\:animate-none {
            /* stylelint-disable-next-line declaration-no-important -- Override animations for accessibility */
            animation: none !important;
        }

        .motion-safe\:transition-none {
            /* stylelint-disable-next-line declaration-no-important -- Override transitions for accessibility */
            transition: none !important;
        }
    }

    // ========================================================================
    // HIGH CONTRAST MODE UTILITIES
    // ========================================================================

    @media (prefers-contrast: high) {
        .contrast-more\:underline {
            text-decoration: underline;
        }

        .contrast-more\:border-2 {
            border-width: 2px;
        }
    }

    // ========================================================================
    // DYNAMIC SPACING UTILITIES
    // Sass-generated utilities using design token scale
    // ========================================================================

    // Negative margins (not all in Tailwind by default)
    @each $name, $value in (
        'xs': var(--space-xs),
        'sm': var(--space-sm),
        'md': var(--space-md),
        'lg': var(--space-lg)
    ) {
        .-mt-#{$name} {
            margin-top: calc(-1 * #{$value});
        }

        .-mb-#{$name} {
            margin-bottom: calc(-1 * #{$value});
        }

        .-ml-#{$name} {
            margin-left: calc(-1 * #{$value});
        }

        .-mr-#{$name} {
            margin-right: calc(-1 * #{$value});
        }
    }
}
