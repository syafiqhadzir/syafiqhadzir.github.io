# SonarCloud Configuration for Google AMP Portfolio
# Eleventy + TypeScript + SCSS Architecture

# Project Identification (SonarCloud format)
sonar.projectKey=syafiqhadzir.github.io
sonar.organization=syafiqhadzir
sonar.host.url=https://sonarcloud.io

# Project Info
sonar.projectName=Syafiq Hadzir Portfolio
sonar.projectVersion=2.0.0

# Source Configuration
# Main source directories (includes scripts for CLI utilities)
sonar.sources=src,_includes,scripts

# Test directories (analyzed separately for reliability, not maintainability)
sonar.tests=test

# Source encoding
sonar.sourceEncoding=UTF-8

# Language-Specific Settings
# TypeScript/JavaScript Coverage (LCOV from Vitest)
sonar.javascript.lcov.reportPaths=coverage/lcov.info

# Test Execution Reports (Generic Test Data from Vitest)
sonar.testExecutionReportPaths=sonar-report.xml

# Performance & Precision: Type-aware analysis
sonar.typescript.tsconfigPath=tsconfig.json

# Environment Configuration
sonar.javascript.environments=node,browser

# SCSS files
sonar.css.stylelint.reportPaths=stylelint-report.json

# HTML Analysis - Only analyze Nunjucks templates
sonar.html.file.suffixes=.njk,.html

# Exclusions (Expert-Level Regex)
# Exclude from analysis entirely
sonar.exclusions=\
  _site/**,\
  node_modules/**,\
  coverage/**,\
  cypress/reports/**,\
  cypress/screenshots/**,\
  cypress/videos/**,\
  dist/**,\
  .cache/**,\
  **/*.min.js,\
  **/*.min.css,\
  **/vendor/**

# Exclude test files from coverage calculation
sonar.coverage.exclusions=\
  test/**,\
  **/*.test.ts,\
  **/*.spec.ts,\
  cypress/**,\
  vitest.config.ts,\
  eleventy.config.js

# Exclude from duplication detection (AMP boilerplate is intentionally duplicated)
sonar.cpd.exclusions=\
  _includes/layouts/**,\
  **/*.njk

# Issue Ignore Rules (AMP-Specific False Positives)
# Multicriteria for ignoring false positives
sonar.issue.ignore.multicriteria=ampCustomStyle,ampBoilerplate,ampBindSyntax

# Ignore inline CSS warnings for AMP files (amp-custom is required by spec)
sonar.issue.ignore.multicriteria.ampCustomStyle.ruleKey=Web:InlineStyleCheck
sonar.issue.ignore.multicriteria.ampCustomStyle.resourceKey=**/*.html

# Ignore duplicate code in AMP boilerplate (required by AMP spec)
sonar.issue.ignore.multicriteria.ampBoilerplate.ruleKey=common-web:DuplicatedBlocks
sonar.issue.ignore.multicriteria.ampBoilerplate.resourceKey=**/*.njk

# Ignore AMP-bind syntax [attribute] patterns (valid AMP, not invalid HTML)
sonar.issue.ignore.multicriteria.ampBindSyntax.ruleKey=Web:S1827
sonar.issue.ignore.multicriteria.ampBindSyntax.resourceKey=**/*.html

# Quality Gate Configuration
# Wait for quality gate result in CI (blocks deployment if fails)
sonar.qualitygate.wait=true
sonar.qualitygate.timeout=300

# Analysis Parameters
# Cognitive Complexity threshold (aligned with ESLint config)
sonar.javascript.maxCognitiveComplexity=15

# Enable additional analyzers
sonar.javascript.node.maxspace=4096

# SCM provider
sonar.scm.provider=git
sonar.scm.forceReloadAll=false

# External Issue Reports
# ESLint report (generated in CI)
sonar.eslint.reportPaths=eslint-report.json

# Logging Configuration
# Production: INFO, CI: DEBUG (override via CLI with -Dsonar.log.level=DEBUG)
sonar.log.level=INFO

# Verbose Mode (Expert-Level Diagnostics)
# Override in CI: -Dsonar.verbose=true
sonar.verbose=false

# Scanner Metadata & Diagnostics
# Track scanner execution details for debugging
sonar.scanner.metadataFilePath=.scannerwork/report-task.txt

# Scanner dump configuration for advanced debugging
# Useful for troubleshooting property resolution and path mapping
# Enable in CI with -Dsonar.scanner.dumpToFile=.scannerwork/scanner-dump.txt

# Path resolution debugging
# When verbose=true, scanner will log detailed file resolution paths
# Helps identify LCOV path mapping issues and coverage gaps
